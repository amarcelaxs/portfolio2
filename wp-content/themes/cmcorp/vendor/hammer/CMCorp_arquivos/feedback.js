Formilla={formillaDomain:"www.formilla.com",csid:0,guid:"",customerName:"",customerPhone:"",customerEmail:"",customField1:"",customField2:"",customField3:"",isChatShown:"",hasAgentResponded:"",chatButton:"",chatMessagesContainer:"",agentIsTypingContainer:"",agentIsTypingMessage:"",agentIsTypingImage:"",lastChatMessageTimestamp:"",chatTextbox:"",spanChatEmailTextbox:"",spanChatEmailTextboxError:"",chatEmailTextbox:"",chatEmailTextboxValidator:"",chatEmailTextboxContainer:"",popupFooterBottom:"",popupChatFooter:"",agentTypingBar:"",startChat:0,emailBoxContainer:"",spanEmailTextbox:"",emailTextbox:"",emailTextboxValidator:"",spanEmailMessage:"",emailMessage:"",emailMessageValidator:"",emailUsButton:"",sendButton:"",startChatButton:"",responseBoxContainer:"",spanFormillaResponseMessage:"",isChatMessageStyleInline:!0,chatPopupTextColor:"",userChatMessageBackgroundColor:"",userChatMessageTextColor:"",chatPopupButtonTextColor:"",chatPopupButtonColor:"",chatPopupButtonMouseoverColor:"",userChatMessageLabel:"Me",autoDisplayMessage:"",wixPageUrl:"",headerIcon:"",offlineButtonText:"",_lastAction:0,_startX:0,_startY:0,_offsetX:0,_offsetY:0,_dragElement:"",_oldZIndex:2147483646,_debug:document.getElementById("_debug"),contentElement:"",contentWidth:0,contentHeight:0,sctop:0,scleft:0,winwidth:0,winheight:0,buttonLocation:0,maxResolutionForMobile:767,pollTimer:"",proactiveTimer:"",autoResponderTimer:"",pollForActionTimer:"",isProactive:!1,isRequestChat:!1,isActionPolling:!1,isMobile:"",hasMobileCSS:!1,mobileCSSSubtractFromHeight:0,isIframe:"",isUserTyping:"",isEmailRequiredToChat:!1,isAttnGrabberVisible:!1,widgetVersion:"",defaultChatMessageCtrHeight:"180px",loadFormillaChatButton:function(){if(Formilla.formillaDomain="www.formilla.com",Formilla.guid=Formilla.guid.trim(),!Formilla.FormillaCheckCookiesEnabled()&&!Formilla.FormillaIsSearchBot())return!1;var a=Formilla.FormillaGetVisitorCookieValue(),b=!1;null!=a&&a.length>0&&(b=!0);var c=("https:"==document.location.protocol?"https://":"http://")+Formilla.formillaDomain+"/ajaxhandler.aspx?rnd="+Math.random();c=c+"&f=loadFormillaChatButton&Guid="+Formilla.guid+"&ChatSessionGuid="+Formilla.getFormillaCookie("formillaChatSession"+Formilla.guid)+"&UserEmail="+Formilla.customerEmail+"&customerName="+encodeURIComponent(Formilla.customerName)+"&customerPhone="+encodeURIComponent(Formilla.customerPhone)+"&screenWidth="+screen.width+"&screenHeight="+screen.height+"&CustomField1="+encodeURIComponent(Formilla.customField1)+"&CustomField2="+encodeURIComponent(Formilla.customField2)+"&CustomField3="+encodeURIComponent(Formilla.customField3)+"&VisitorGuid="+a+"&IsReturning="+b+"&IsChatWindowVisible="+Formilla.getFormillaCookie("formillaIsChatWindowOpen"+Formilla.guid)+"&AutoDisplayChatShown="+Formilla.getFormillaCookie("AutoDisplayChatShown"+Formilla.guid)+"&referrer="+encodeURIComponent(document.referrer)+"&pageURL="+encodeURIComponent(Formilla.FormillaGetCurrentPageUrl())+"&callback=renderFormillaChatButton",Formilla.dynamicJSONTag(c),Formilla.initFormillaMobile()},dynamicJSONTag:function(a){var b=document.getElementsByTagName("head").item(0),c=document.createElement("script");c.setAttribute("type","text/javascript"),c.setAttribute("src",a),b.appendChild(c),setTimeout(function(){b.removeChild(c)},1e3)},renderFormillaChatButton:function(a){if(null!=a){var b=document.getElementsByTagName("head").item(0),c=document.createElement("style");if(c.type="text/css",c.styleSheet?c.styleSheet.cssText=a.LiveChatCSS:c.appendChild(document.createTextNode(a.LiveChatCSS)),b.appendChild(c),Formilla.isMobile.any()&&null!=a.MobileCSS&&a.MobileCSS.length>0&&null!=a.MobileCSSSubtractFromHeight&&a.MobileCSSSubtractFromHeight.length>0){Formilla.hasMobileCSS=!0,Formilla.mobileCSSSubtractFromHeight=parseInt(a.MobileCSSSubtractFromHeight);var c=document.createElement("style");c.type="text/css",c.styleSheet?c.styleSheet.cssText=a.MobileCSS:c.appendChild(document.createTextNode(a.MobileCSS)),b.appendChild(c)}Formilla.widgetVersion=a.WidgetVersion,"3"==Formilla.widgetVersion?Formilla.defaultChatMessageCtrHeight="230px":Formilla.defaultChatMessageCtrHeight="180px";var d=document.getElementsByTagName("body").item(0),e=document.createElement("div"),f=document.createElement("div");if(f.setAttribute("id","divFormillaChatCtr"),e.setAttribute("id","formilla-chat-button"),e.innerHTML=a.FormillaChatButton,f.innerHTML=a.ChatPopup,d.appendChild(e),d.appendChild(f),Formilla.FormillaWriteVisitorCookieValue(a.VisitorGuid),"True"==a.DeleteChatCookie&&(document.cookie="formillaChatSession"+Formilla.guid+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/",document.getElementById("hdnFormillaSessionId").value=""),"True"==a.IsEmailRequiredToChat&&(Formilla.isEmailRequiredToChat=!0),"True"==a.PollForAction&&(Formilla.isActionPolling=!0,document.onmousemove=Formilla.FormillaChatUpdateLastAction,Formilla.FormillaChatUpdateLastAction(null)),"no"==Formilla.getFormillaCookie("formillaIsChatWindowOpen"+Formilla.guid)&&(document.cookie="formillaIsChatWindowOpen"+Formilla.guid+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"),document.getElementById("hdnFormillaSessionId").value.length<=0?"True"==a.HasAgentRequestedChat?Formilla.FormillaProcessAgentRequestedChat(a):"True"==a.IsProactiveChatEnabled&&(Formilla.autoDisplayMessage=a.AutoDisplayMessage,Formilla.AutoPopUpFormillaChat(a)):Formilla.FormillaShowMinimizeButton(!0),"True"==a.ShowEmailForm?Formilla.isChatShown=!1:Formilla.isChatShown=!0,Formilla.chatButton=document.getElementById("formilla-chat-button-inner"),Formilla.buttonLocation=a.ButtonLocation,!Formilla.isIframe&&null!=a.MobileChatButtonText&&a.MobileChatButtonText.length>0)try{screen.width<=Formilla.maxResolutionForMobile&&(document.getElementById("formilla-chat-button-text").innerHTML=a.MobileChatButtonText)}catch(g){}"True"==a.IsChatMessageStyleInline?Formilla.isChatMessageStyleInline=!0:Formilla.isChatMessageStyleInline=!1,Formilla.chatPopupTextColor=a.ChatPopupTextColor,Formilla.userChatMessageBackgroundColor=a.UserChatMessageBackgroundColor,Formilla.userChatMessageTextColor=a.UserChatMessageTextColor,Formilla.chatPopupButtonTextColor=a.ChatPopupButtonTextColor,Formilla.chatPopupButtonColor=a.ChatPopupButtonColor,Formilla.chatPopupButtonMouseoverColor=a.ChatPopupButtonMouseoverColor,Formilla.offlineButtonText=a.OfflineButtonText,Formilla.userChatMessageLabel=a.UserChatMessageLabel,document.getElementById("hdnFormillaSessionId").value.length>0&&"True"!=a.SupressChatAutoShow&&(Formilla.AutoInitFormillaChat(),Formilla.FormillaAdjustHeight(Formilla.defaultChatMessageCtrHeight),null!=a.autoResponderTimer&&a.autoResponderTimer>0&&Formilla.startFormillaAutoResponderTimer(a.autoResponderTimer),"True"==a.IsStatusDisplay&&(Formilla.chatTextbox.disabled=!0));var h=parseInt(Formilla.FormillaGetStyle(Formilla.chatButton,"bottom"));Formilla.isMobile.any()||(null!=document.getElementById("formilla-attn-grabber-ctr")&&"yes"!=Formilla.getFormillaCookie("AttnGrabberClosed"+Formilla.guid)&&(0>h?setTimeout(function(){document.getElementById("formilla-attn-grabber-ctr").style.display="block"},400):document.getElementById("formilla-attn-grabber-ctr").style.display="block",Formilla.isAttnGrabberVisible=!0),null!=document.getElementById("formilla-off-attn-grabber-ctr")&&"yes"!=Formilla.getFormillaCookie("OfflineAttnGrabberClosed"+Formilla.guid)&&(0>h?setTimeout(function(){document.getElementById("formilla-off-attn-grabber-ctr").style.display="block"},400):document.getElementById("formilla-off-attn-grabber-ctr").style.display="block",Formilla.isAttnGrabberVisible=!0)),document.getElementById("hdnFormillaSessionId").value.length<=0&&Formilla.isAttnGrabberVisible&&!Formilla.isProactive?Formilla.FormillaResizeIframeContainer(340,300):document.getElementById("hdnFormillaSessionId").value.length<=0&&!Formilla.isProactive&&Formilla.FormillaResizeIframeContainer(340,50),0>h&&setTimeout(function(){Formilla.slideUpFormillaChatButton(h)},1e3),Formilla.FormillaAdjustHeightForMobile(),Formilla.convertFormillaChatMessageTime()}},convertFormillaChatMessageTime:function(){var a=document.getElementsByClassName("formillaChatWidgetMessageTime");if(a&&a.length>0)for(var b=0;b<a.length;b++){var c=new Date(a[b].innerHTML);isNaN(c)||(a[b].innerHTML=Formilla.getFormillaTimeFromUtcDate(c))}},getFormillaTimeFromUtcDate:function(a){var b=new Date(a.getTime()+60*a.getTimezoneOffset()*1e3),c=a.getTimezoneOffset()/60,d=a.getHours();return b.setHours(d-c),Formilla.formatFormillaMessageDate(b)},formatFormillaMessageDate:function(a){var b=a.getHours(),c=a.getMinutes(),d=b%12||12,e=10>c?"0"+c:c,f=12>b?" AM":" PM";return d+":"+e+f},slideUpFormillaChatButton:function(a){a+=1,Formilla.chatButton.style.bottom=a+"px",0>a&&setTimeout(function(){Formilla.slideUpFormillaChatButton(a)},5)},resetFormillaEmailFields:function(){Formilla.chatTextbox.value="",Formilla.emailTextbox.value="",Formilla.emailMessage.value="",Formilla.spanEmailTextbox.style.display="block",Formilla.spanEmailMessage.style.display="block",Formilla.responseBoxContainer.style.display="none",Formilla.emailTextbox.style.background="#ffffff",Formilla.emailMessage.style.background="#ffffff"},ShowFormillaChatBox:function(){Formilla.isChatShown=!0,Formilla.chatMessagesContainer.style.display="block",Formilla.chatTextbox.style.display="none",Formilla.emailBoxContainer.style.display="none",Formilla.responseBoxContainer.style.display="none",Formilla.sendButton.style.display="none",Formilla.chatEmailTextbox.style.display="inline-block",Formilla.FormillaShowElement(Formilla.chatEmailTextboxContainer),Formilla.FormillaShowElement(Formilla.popupFooterBottom),Formilla.FormillaHideElement(Formilla.popupChatFooter),Formilla.FormillaHideElement(Formilla.agentTypingBar),""==Formilla.chatEmailTextbox.value.trim()?Formilla.spanChatEmailTextbox.style.display="block":Formilla.spanChatEmailTextbox.style.display="none",Formilla.startChatButton.style.display="block"},ShowFormillaEmailBox:function(){Formilla.isChatShown=!1,Formilla.chatMessagesContainer.style.display="none",Formilla.agentIsTypingContainer.style.display="none",Formilla.chatTextbox.style.display="none",Formilla.emailUsButton.style.display="none",Formilla.chatEmailTextbox.style.display="none",Formilla.FormillaHideElement(Formilla.chatEmailTextboxContainer),Formilla.FormillaHideElement(Formilla.popupFooterBottom),Formilla.spanChatEmailTextbox.style.display="none",Formilla.spanChatEmailTextboxError.style.display="none",Formilla.startChatButton.style.display="none",Formilla.emailBoxContainer.style.display="",Formilla.sendButton.style.display="",Formilla.proactiveTimer&&window.clearInterval(Formilla.proactiveTimer),"3"==Formilla.widgetVersion&&Formilla.FormillaShowElement(Formilla.popupFooterBottom)},FormillaValidateEmailFields:function(){var a=Formilla.FormillaValidateEmailAddress(!0),b=Formilla.FormillaValidateEmailMessage(!0);return a&&b?!0:!1},FormillaValidateEmailAddress:function(a){return Formilla.FormillaIsValidEmail(Formilla.emailTextbox.value)?("3"==Formilla.widgetVersion?Formilla.emailTextbox.parentElement.className="formillaFocus":Formilla.emailTextbox.style.border="1px solid green",Formilla.emailTextboxValidator=!0,!0):((Formilla.emailTextboxValidator||a)&&("3"==Formilla.widgetVersion?Formilla.emailTextbox.parentElement.className="formillaError":Formilla.emailTextbox.style.border="1px solid red"),!1)},FormillaValidateEmailMessage:function(a){return""!=Formilla.emailMessage.value.trim()&&null!=Formilla.emailMessage.value?("3"==Formilla.widgetVersion?Formilla.emailMessage.parentElement.className="formillaFocus":Formilla.emailMessage.style.border="1px solid green",Formilla.emailMessageValidator=!0,!0):((Formilla.emailMessageValidator||a)&&("3"==Formilla.widgetVersion?Formilla.emailMessage.parentElement.className="formillaError":Formilla.emailMessage.style.border="1px solid red"),!1)},FormillaValidateChatEmailAddress:function(a){return Formilla.FormillaIsValidEmail(Formilla.chatEmailTextbox.value)?(Formilla.spanChatEmailTextboxError.style.display="none","3"==Formilla.widgetVersion?Formilla.chatEmailTextbox.parentElement.className="formillaFocus":Formilla.chatEmailTextbox.style.border="1px solid green",Formilla.chatEmailTextboxValidator=!0,!0):((Formilla.chatEmailTextboxValidator||a)&&("3"==Formilla.widgetVersion?Formilla.chatEmailTextbox.parentElement.className="formillaError":Formilla.chatEmailTextbox.style.border="1px solid red"),!1)},FormillaSendEmail:function(){if(Formilla.FormillaValidateEmailFields()){Formilla.sendButton.style.display="none","3"==Formilla.widgetVersion?Formilla.FormillaShowResponseBoxContainer("<div style='text-align:center !important; display: block !important;'><img src='"+("https:"==document.location.protocol?"https://":"http://")+Formilla.formillaDomain+"/remoteAssets/img/loading.gif' alt='Sending message...' / style='width: 80px;display: inline;'></div>"):Formilla.FormillaShowResponseBoxContainer("<br /><br /><br /><br /><div style='text-align:center'><img src='"+("https:"==document.location.protocol?"https://":"http://")+Formilla.formillaDomain+"/images/form/loader.gif' alt='Sending message...' /></div>");var a=("https:"==document.location.protocol?"https://":"http://")+Formilla.formillaDomain+"/ajaxhandler.aspx?rnd="+Math.random();a=a+"&f=sendFormillaEmail&Guid="+Formilla.guid+"&txtFormillaEmail="+encodeURIComponent(Formilla.emailTextbox.value.trim())+"&txtFormillaEmailMessage="+encodeURIComponent(Formilla.HTMLEncode(Formilla.emailMessage.value))+"&pageURL="+encodeURIComponent(Formilla.FormillaGetCurrentPageUrl())+"&customerName="+encodeURIComponent(Formilla.customerName)+"&customerPhone="+encodeURIComponent(Formilla.customerPhone)+"&screenWidth="+screen.width+"&screenHeight="+screen.height+"&CustomField1="+encodeURIComponent(Formilla.customField1)+"&CustomField2="+encodeURIComponent(Formilla.customField2)+"&CustomField3="+encodeURIComponent(Formilla.customField3)+"&callback=FormillaSendEmailCallback",Formilla.dynamicJSONTag(a)}},FormillaShowResponseBoxContainer:function(a){Formilla.chatMessagesContainer.style.display="none",Formilla.agentIsTypingContainer.style.display="none",Formilla.emailBoxContainer.style.display="none",Formilla.responseBoxContainer.style.display="",Formilla.spanFormillaResponseMessage.innerHTML=a,Formilla.FormillaAdjustHeight("")},FormillaSendEmailCallback:function(a){null!=a&&("3"==Formilla.widgetVersion?Formilla.FormillaShowResponseBoxContainer("<i class='formilla-i-check'></i><p style='font-size: 15px !important; line-height: 20px; font-family: sans-serif !important; color: "+Formilla.chatPopupTextColor+" !important;'>"+a.message+"</p><a href='javascript:void(0)' style='font-family: sans-serif !important; cursor:pointer; color:"+Formilla.chatPopupButtonTextColor+"; background-color:"+Formilla.chatPopupButtonColor+";' onclick='Formilla.resetFormillaEmailFields();Formilla.ShowFormillaEmailBox();' onmouseout=\"this.style.backgroundColor = '"+Formilla.chatPopupButtonColor+"'\" onmouseover=\"this.style.backgroundColor = '"+Formilla.chatPopupButtonMouseoverColor+"'\">"+Formilla.offlineButtonText+"</a>"):Formilla.FormillaShowResponseBoxContainer(a.message))},endFormillaChatSession:function(a){var b=document.getElementById("hdnFormillaSessionId").value,c=("https:"==document.location.protocol?"https://":"http://")+Formilla.formillaDomain+"/ajaxhandler.aspx?rnd="+Math.random();c=c+"&f=endFormillaChatSession&hdnFormillaSessionId="+b,Formilla.dynamicJSONTag(c)},hideFormillaChatWindow:function(a,b){var c=Formilla.getFormillaCookie("formillaChatSession"+Formilla.guid);if(Formilla.isAttnGrabberVisible?Formilla.FormillaResizeIframeContainer(340,300):Formilla.FormillaResizeIframeContainer(340,50),null!=c){if(Formilla.hideFormillaEndChatPopup(),Formilla.agentIsTypingMessage.style.display="none",Formilla.FormillaHideElement(Formilla.agentIsTypingImage),Formilla.endFormillaChatSession(c),document.cookie="formillaChatSession"+Formilla.guid+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/",document.getElementById("hdnFormillaSessionId").value="",Formilla.pollTimer&&window.clearInterval(Formilla.pollTimer),document.cookie="formillaIsChatWindowOpen"+Formilla.guid+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/",document.cookie="formillaRequestChat"+Formilla.guid+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/",Formilla.FormillaShowMinimizeButton(!1),"3"==Formilla.widgetVersion){var d=document.createElement("ul");d.innerHTML="<li style='text-align: center !important;'><div style='display: inline-block !important; color: "+Formilla.ChatPopupTextColor+";'>Your chat session has ended.</div></li>",Formilla.chatMessagesContainer.appendChild(d.firstChild),Formilla.chatTextbox.disabled=!0}else{var d=document.createElement("div");d.innerHTML='<div style="clear:both; color:red; margin-bottom: 7px;">Your chat session has ended.</div>',Formilla.chatMessagesContainer.appendChild(d.firstChild),Formilla.ShowFormillaChatBox()}Formilla.chatMessagesContainer.scrollTop=Formilla.chatMessagesContainer.scrollHeight,"3"==Formilla.widgetVersion&&(Formilla.headerIcon.className="formilla-i-h-message on formilla-drag")}else Formilla.isProactive&&(document.cookie="formillaIsChatWindowOpen"+Formilla.guid+"=no; path=/"),document.cookie="formillaRequestChat"+Formilla.guid+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/",Formilla.isProactive||"3"==Formilla.widgetVersion||(Formilla.isChatShown?Formilla.ShowFormillaChatBox():Formilla.ShowFormillaEmailBox(),Formilla.resetFormillaEmailFields());Formilla.isIframe||(Formilla.contentHeight=Formilla.contentElement.offsetHeight,Formilla.FormillaRealignWidget()),document.getElementById(a).style.display="none",Formilla.FormillaRemoveMobileOverlayStyles()},showFormillaEndChatPopup:function(a,b){var c=Formilla.getFormillaCookie("formillaChatSession"+Formilla.guid);null!=c?(document.getElementById("formillaEndChatAlert").innerHTML=b,document.getElementById("formillaEndChatPopup").style.display="block"):Formilla.hideFormillaChatWindow(a,b)},hideFormillaEndChatPopup:function(){document.getElementById("formillaEndChatPopup").style.display="none"},AutoPopUpFormillaChat:function(a){timer=a.AutoDisplayTimer,"yes"!=Formilla.getFormillaCookie("AutoDisplayChatShown"+Formilla.guid)?(Formilla.pollTimer&&window.clearInterval(Formilla.pollTimer),Formilla.proactiveTimer=window.setInterval(function(){Formilla.LaunchFormillaAutoChat(a)},1e3*timer)):"yes"==Formilla.getFormillaCookie("formillaIsChatWindowOpen"+Formilla.guid)&&"yes"!=Formilla.getFormillaCookie("formillaRequestChat"+Formilla.guid)&&Formilla.FormillaTriggerProactiveChatMessage(a)},LaunchFormillaAutoChat:function(a){"none"!=document.getElementById("divFormillaChat").style.display||"yes"==Formilla.getFormillaCookie("AutoDisplayChatShown"+Formilla.guid)?Formilla.proactiveTimer&&window.clearInterval(Formilla.proactiveTimer):Formilla.FormillaTriggerProactiveChatMessage(a),document.cookie="AutoDisplayChatShown"+Formilla.guid+"=yes; path=/"},getFormillaCookie:function(a){var b,c,d,e=document.cookie.split(";");for(b=0;b<e.length;b++)if(c=e[b].substr(0,e[b].indexOf("=")),d=e[b].substr(e[b].indexOf("=")+1),c=c.replace(/^\s+|\s+$/g,""),c==a)return unescape(d)},getFormillaWindowHeight:function(){var a=0;return"number"==typeof window.innerHeight?a=window.innerHeight:document.documentElement&&document.documentElement.clientHeight?a=document.documentElement.clientHeight:document.body&&document.body.clientHeight&&(a=document.body.clientHeight),a},initFormillaDragDrop:function(a){Formilla.isIframe||(document.onmousedown=Formilla.FormillaChatOnMouseDown,document.onmouseup=Formilla.FormillaChatOnMouseUp),Formilla.contentElement=document.getElementById("divFormillaChat"),Formilla.contentWidth=Formilla.contentElement.offsetWidth,Formilla.contentHeight=Formilla.contentElement.offsetHeight,Formilla.sctop=parseInt(document.documentElement.scrollTop),Formilla.scleft=parseInt(document.documentElement.scrollLeft),Formilla.winwidth=parseInt(document.documentElement.clientWidth),Formilla.winheight=parseInt(document.documentElement.clientHeight),Formilla._dragElement=document.getElementById("divFormillaChat");var b="right";"css"!=Formilla.buttonLocation&&1!=a?"bottom-right"==Formilla.buttonLocation||"middle-right"==Formilla.buttonLocation?(Formilla._dragElement.style.left=Formilla.winwidth-Formilla.contentWidth+"px",b="right"):(Formilla._dragElement.style.left="0px",b="left"):("css"==Formilla.buttonLocation||a)&&(parseInt(Formilla.FormillaGetStyle(Formilla._dragElement,"left"))>=0?(Formilla._dragElement.style.left=Formilla.FormillaGetStyle(Formilla._dragElement,"left"),b="left"):parseInt(Formilla.FormillaGetStyle(Formilla._dragElement,"right"))>=0?(Formilla._dragElement.style.left=Formilla.winwidth-Formilla.contentWidth-parseInt(Formilla.FormillaGetStyle(Formilla._dragElement,"right"))+"px",b="right"):(Formilla._dragElement.style.left=Formilla.winwidth-Formilla.contentWidth+"px",b="right")),Formilla.isIframe||(0==Formilla._dragElement.style.top||""==Formilla._dragElement.style.top)&&(Formilla._dragElement.style.top=Formilla.winheight-Formilla.contentHeight+"px"),Formilla.isMobile.any()&&Formilla.positionFormillaForMobile(b)},positionFormillaForMobile:function(a){"right"==a?(Formilla._dragElement.style.top="auto",Formilla._dragElement.style.left="auto",Formilla._dragElement.style.bottom="0px",Formilla._dragElement.style.right="0px"):"left"==a&&(Formilla._dragElement.style.top="auto",Formilla._dragElement.style.left="0px",Formilla._dragElement.style.bottom="0px",Formilla._dragElement.style.right="auto")},FormillaChatOnMouseDown:function(a){null==a&&(a=window.event);var b=null!=a.target?a.target:a.srcElement;return(1==a.button&&null!=window.event||0==a.button)&&b.className.indexOf("formilla-drag")>=0?(Formilla._startX=a.clientX,Formilla._startY=a.clientY,Formilla._dragElement=document.getElementById("divFormillaChat"),b=Formilla._dragElement,Formilla._offsetX=Formilla.ExtractNumber(b.style.left),Formilla._offsetY=Formilla.ExtractNumber(b.style.top),Formilla._oldZIndex=b.style.zIndex,b.style.zIndex=2147483647,document.onmousemove=Formilla.FormillaChatOnMouseMove,document.body.focus(),document.onselectstart=function(){return!1},b.ondragstart=function(){return!1},!1):void 0},FormillaChatOnMouseMove:function(a){if(null==a)var a=window.event;Formilla._dragElement.style.left=Formilla._offsetX+a.clientX-Formilla._startX+"px",Formilla._dragElement.style.top=Formilla._offsetY+a.clientY-Formilla._startY+"px",Formilla._offsetX+a.clientX-Formilla._startX<=0?Formilla._dragElement.style.left="0px":Formilla._offsetX+a.clientX-Formilla._startX>=Formilla.winwidth-Formilla.contentWidth&&(Formilla._dragElement.style.left=Formilla.winwidth-Formilla.contentWidth+"px"),Formilla._offsetY+a.clientY-Formilla._startY<=0?Formilla._dragElement.style.top="0px":Formilla._offsetY+a.clientY-Formilla._startY>=Formilla.winheight-Formilla.contentHeight&&(Formilla._dragElement.style.top=Formilla.winheight-Formilla.contentHeight+"px")},FormillaChatOnMouseUp:function(a){null!=Formilla._dragElement&&(Formilla._dragElement.style.zIndex=Formilla._oldZIndex,document.onmousemove=null,document.onselectstart=null,Formilla._dragElement.ondragstart=null,Formilla.isActionPolling&&(document.onmousemove=Formilla.FormillaChatUpdateLastAction),Formilla._dragElement=null)},FormillaChatUpdateLastAction:function(a){if(null==a)var a=window.event;Formilla._lastAction=new Date,document.getElementById("hdnFormillaSessionId").value.length<=0&&!Formilla.pollForActionTimer&&Formilla.startFormillaPollForActionTimer()},FormillaStartChat:function(){Formilla.startChat=1,Formilla.isEmailRequiredToChat?Formilla.FormillaValidateChatEmailAddress(!0)?(Formilla.spanChatEmailTextboxError.style.display="none",Formilla.startChatButton.style.display="none",Formilla.FormillaSendMessage(Formilla.chatEmailTextbox.value.trim()),Formilla.FormillaAdjustHeight(Formilla.defaultChatMessageCtrHeight),"3"==Formilla.widgetVersion&&(Formilla.headerIcon.className="formilla-i-h-user formilla-drag")):Formilla.spanChatEmailTextboxError.style.display="block":Formilla.chatEmailTextbox.value.trim().length>0?(Formilla.spanChatEmailTextboxError.style.display="none",Formilla.startChatButton.style.display="none",Formilla.FormillaSendMessage(Formilla.chatEmailTextbox.value.trim()),Formilla.FormillaAdjustHeight(Formilla.defaultChatMessageCtrHeight),"3"==Formilla.widgetVersion&&(Formilla.headerIcon.className="formilla-i-h-user formilla-drag")):Formilla.spanChatEmailTextboxError.style.display="block"},handleOnEnterKey:function(a,b){if("Microsoft Internet Explorer"==navigator.appName){if(13==event.keyCode)return Formilla.FormillaSendMessage(Formilla.chatTextbox.value),!1}else if(13==b.keyCode)return Formilla.FormillaSendMessage(Formilla.chatTextbox.value),!1},handleOnKeyUp:function(a,b){Formilla.FormillaIsUserTyping()},handleOnChange:function(a,b){Formilla.FormillaIsUserTyping()},handleOnClick:function(a,b){Formilla.hasMobileCSS&&Formilla.isMobile.any()&&screen.width<=Formilla.maxResolutionForMobile&&setTimeout(function(){Formilla.FormillaAdjustHeight(Formilla.contentElement.scrollHeight-Formilla.mobileCSSSubtractFromHeight+"px"),Formilla.chatMessagesContainer.scrollTop=Formilla.chatMessagesContainer.scrollHeight},500)},handleOnBlur:function(a,b){Formilla.hasMobileCSS&&Formilla.isMobile.any()&&screen.width<=Formilla.maxResolutionForMobile&&setTimeout(function(){Formilla.FormillaAdjustHeight(Formilla.contentElement.scrollHeight-Formilla.mobileCSSSubtractFromHeight+"px"),Formilla.chatMessagesContainer.scrollTop=Formilla.chatMessagesContainer.scrollHeight},500)},FormillaIsUserTyping:function(){Formilla.chatTextbox.value.trim().length>0?Formilla.isUserTyping=!0:Formilla.isUserTyping=!1},bindFormillaOnEnterKey:function(){Formilla.chatTextbox.onkeydown=function(a){return Formilla.handleOnEnterKey(this,a)},Formilla.chatTextbox.onkeyup=function(a){return Formilla.handleOnKeyUp(this,a)},Formilla.chatTextbox.onchange=function(a){return Formilla.handleOnChange(this,a)},Formilla.chatTextbox.onclick=function(a){return Formilla.handleOnClick(this,a)},Formilla.chatTextbox.onblur=function(a){return Formilla.handleOnBlur(this,a)}},handleOnEnterKeyChatEmail:function(a,b){if("Microsoft Internet Explorer"==navigator.appName){if(13==event.keyCode)return Formilla.FormillaStartChat(),!1}else if(13==b.keyCode)return Formilla.FormillaStartChat(),!1},bindFormillaOnEnterKeyChatEmail:function(){Formilla.chatEmailTextbox.onkeydown=function(a){return Formilla.handleOnEnterKeyChatEmail(this,a)}},bindFormillaEmailEvents:function(){Formilla.chatEmailTextbox.onkeypress,Formilla.chatEmailTextbox.onkeydown,Formilla.chatEmailTextbox.onkeyup=function(a){""==Formilla.chatEmailTextbox.value.trim()?(Formilla.spanChatEmailTextbox.style.display="block","3"==Formilla.widgetVersion&&(Formilla.chatEmailTextbox.parentElement.className="formillaError")):(Formilla.spanChatEmailTextbox.style.display="none","3"==Formilla.widgetVersion&&(Formilla.chatEmailTextbox.parentElement.className="formillaFocus")),Formilla.isEmailRequiredToChat&&Formilla.FormillaValidateChatEmailAddress(!1)},Formilla.chatEmailTextbox.onblur=function(a){return Formilla.isEmailRequiredToChat&&Formilla.FormillaValidateChatEmailAddress(!0),""==Formilla.chatEmailTextbox.value.trim()?(""==Formilla.spanChatEmailTextbox.style.display,"3"==Formilla.widgetVersion&&(Formilla.chatEmailTextbox.parentElement.className="formillaError"),!1):void 0},Formilla.emailTextbox.onkeypress,Formilla.emailTextbox.onkeydown,Formilla.emailTextbox.onkeyup=function(a){""==Formilla.emailTextbox.value.trim()?Formilla.spanEmailTextbox.style.display="block":Formilla.spanEmailTextbox.style.display="none",Formilla.FormillaValidateEmailAddress(!1)},Formilla.emailMessage.onkeypress,Formilla.emailMessage.onkeydown,Formilla.emailMessage.onkeyup=function(a){""==Formilla.emailMessage.value.trim()?Formilla.spanEmailMessage.style.display="block":Formilla.spanEmailMessage.style.display="none",Formilla.FormillaValidateEmailMessage(!1)},Formilla.emailTextbox.onblur=function(a){return Formilla.FormillaValidateEmailAddress(!0),""==Formilla.emailTextbox.value.trim()?(""==Formilla.spanEmailTextbox.style.display,!1):void 0},Formilla.emailMessage.onblur=function(a){return Formilla.FormillaValidateEmailMessage(!0),""==Formilla.emailMessage.value.trim()?(""==Formilla.spanEmailMessage.style.display,!1):void 0}},initFormillaChatFields:function(){Formilla.chatMessagesContainer=document.getElementById("divFormillaChatMessages"),Formilla.agentIsTypingContainer=document.getElementById("divFormillaAgentIsTypingCtr"),Formilla.agentIsTypingMessage=document.getElementById("spanFormillaAgentIsTyping"),Formilla.agentIsTypingImage=document.getElementById("formillaAgentIsTypingImage"),Formilla.lastChatMessageTimestamp=document.getElementById("hdnLastChatMessageTimestamp"),Formilla.chatTextbox=document.getElementById("txtFormillaMessage"),Formilla.spanChatEmailTextbox=document.getElementById("spanFormillaChatEmailTextbox"),Formilla.spanChatEmailTextboxError=document.getElementById("spanFormillaChatEmailTextboxError"),Formilla.chatEmailTextbox=document.getElementById("txtFormillaChatEmailTextbox"),Formilla.chatEmailTextboxContainer=document.getElementById("txtFormillaChatEmailTextboxContainer"),Formilla.popupFooterBottom=document.getElementById("formillaPopupFooterBeforeChat"),Formilla.popupChatFooter=document.getElementById("formillaPopupChatFooter"),Formilla.agentTypingBar=document.getElementById("formillaAgentTypingBar"),Formilla.emailBoxContainer=document.getElementById("divFormillaEmailBox"),Formilla.spanEmailTextbox=document.getElementById("spanFormillaEmailTextbox"),Formilla.emailTextbox=document.getElementById("txtFormillaEmailTextbox"),Formilla.spanEmailMessage=document.getElementById("spanFormillaEmailMessage"),Formilla.emailMessage=document.getElementById("txtFormillaEmailMessage"),Formilla.emailUsButton=document.getElementById("formillaEmailButton"),Formilla.sendButton=document.getElementById("formillaSendButton"),Formilla.startChatButton=document.getElementById("formillaStartChatButton"),Formilla.responseBoxContainer=document.getElementById("divFormillaResponseBox"),Formilla.spanFormillaResponseMessage=document.getElementById("spanFormillaResponseMessage"),Formilla.headerIcon=document.getElementById("formillaHeaderIcon"),Formilla.headerAgentPicture=document.getElementById("formillaHeaderAgentPicture"),Formilla.formillaChatEmailTextboxIcon=document.getElementById("formillaChatEmailTextboxIcon")},initFormillaChatShowChatWindow:function(){if(document.getElementById("divFormillaChat").style.display="",document.getElementById("divFormillaChat").style.visibility="visible",Formilla.initFormillaDragDrop(!0),Formilla.bindFormillaOnEnterKey(),Formilla.bindFormillaOnEnterKeyChatEmail(),Formilla.bindFormillaEmailEvents(),Formilla.isMobile.any()||Formilla.chatTextbox.focus(),Formilla.getFormillaCookie("formillaChatSession"+Formilla.guid)&&(Formilla.pollTimer||Formilla.startFormillaPollTimer()),Formilla.chatMessagesContainer.scrollTop=Formilla.chatMessagesContainer.scrollHeight,Formilla.hasMobileCSS&&"yes"!=Formilla.getFormillaCookie("formillaIsMinimized"+Formilla.guid)){var a=document.getElementsByTagName("head").item(0),b=document.getElementById("formilla-mobile-overlay");if(null==b){var c=document.createElement("style");c.type="text/css",c.setAttribute("id","formilla-mobile-overlay"),mobileCss="@media (max-width: "+Formilla.maxResolutionForMobile+"px) { body > * { display: none !important; } #divFormillaChatCtr { display: block !important; } }",c.styleSheet?c.styleSheet.cssText=mobileCss:c.appendChild(document.createTextNode(mobileCss)),a.appendChild(c)}}else Formilla.chatEmailTextbox.focus();"yes"==Formilla.getFormillaCookie("formillaIsMinimized"+Formilla.guid)&&(document.getElementById("divFormillaChat").style.visibility="hidden")},AutoInitFormillaChat:function(){Formilla.FormillaResizeIframeContainer(340,450),Formilla.initFormillaChatFields(),Formilla.initFormillaChatShowChatWindow(),""!=Formilla.customerEmail.trim()&&Formilla.isEmailRequiredToChat&&(Formilla.chatEmailTextbox.value=Formilla.customerEmail.trim(),
Formilla.spanChatEmailTextbox.innerHTML="","3"==Formilla.widgetVersion&&(Formilla.chatEmailTextbox.parentElement.className="formillaFocus")),Formilla.hasMobileCSS&&screen.width<=Formilla.maxResolutionForMobile&&setTimeout(function(){Formilla.FormillaAdjustHeight(Formilla.contentElement.scrollHeight-Formilla.mobileCSSSubtractFromHeight+"px"),Formilla.chatMessagesContainer.scrollTop=Formilla.chatMessagesContainer.scrollHeight},500)},initFormillaChat:function(){document.cookie="formillaIsMinimized"+Formilla.guid+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/",Formilla.AutoInitFormillaChat(),Formilla.FormillaRealignWidget()},initProactiveFormillaChat:function(){Formilla.FormillaResizeIframeContainer(340,450),Formilla.initFormillaChatFields(),Formilla.initFormillaChatShowChatWindow(),Formilla.chatEmailTextbox.style.display="none",Formilla.FormillaHideElement(Formilla.chatEmailTextboxContainer),Formilla.FormillaHideElement(Formilla.popupFooterBottom),Formilla.FormillaShowElement(Formilla.popupChatFooter),Formilla.FormillaShowElement(Formilla.agentTypingBar),Formilla.spanChatEmailTextbox.style.display="none",Formilla.spanChatEmailTextboxError.style.display="none",Formilla.startChatButton.style.display="none",Formilla.chatTextbox.style.display="",Formilla.chatTextbox.disabled=!1,Formilla.chatTextbox.focus()},startFormillaPollTimer:function(){Formilla.proactiveTimer&&window.clearInterval(Formilla.proactiveTimer),Formilla.pollTimer=window.setInterval(Formilla.GetNewFormillaMessages,3e3)},startFormillaPollForActionTimer:function(){Formilla.pollForActionTimer=window.setInterval(Formilla.FormillaPollForAction,5e3)},FormillaPollForAction:function(){var a=new Date,b=Math.round((a-Formilla._lastAction)/1e3);if(60>=b&&document.getElementById("hdnFormillaSessionId").value.length<=0){var c=Formilla.FormillaGetVisitorCookieValue(),d=!1;if(null!=c&&c.length>0&&(d=!0),null!=c&&c.length>0){var e=("https:"==document.location.protocol?"https://":"http://")+Formilla.formillaDomain+"/ajaxhandler.aspx?rnd="+Math.random();e=e+"&f=pollForAction&Guid="+Formilla.guid+"&VisitorGuid="+c+"&UserEmail="+Formilla.customerEmail+"&customerName="+encodeURIComponent(Formilla.customerName)+"&customerPhone="+encodeURIComponent(Formilla.customerPhone)+"&screenWidth="+screen.width+"&screenHeight="+screen.height+"&CustomField1="+encodeURIComponent(Formilla.customField1)+"&CustomField2="+encodeURIComponent(Formilla.customField2)+"&CustomField3="+encodeURIComponent(Formilla.customField3)+"&IsReturning="+d+"&IsChatWindowVisible="+Formilla.getFormillaCookie("formillaIsChatWindowOpen"+Formilla.guid)+"&referrer="+encodeURIComponent(document.referrer)+"&pageURL="+encodeURIComponent(Formilla.FormillaGetCurrentPageUrl())+"&callback=processFormillaAction",Formilla.dynamicJSONTag(e)}}else Formilla.pollForActionTimer&&(window.clearInterval(Formilla.pollForActionTimer),Formilla.pollForActionTimer="")},processFormillaAction:function(a){null!=a&&(Formilla.FormillaWriteVisitorCookieValue(a.VisitorGuid),"no"==Formilla.getFormillaCookie("formillaIsChatWindowOpen"+Formilla.guid)&&(document.cookie="formillaIsChatWindowOpen"+Formilla.guid+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"),document.getElementById("hdnFormillaSessionId").value.length<=0&&"True"==a.HasAgentRequestedChat&&Formilla.FormillaProcessAgentRequestedChat(a))},FormillaProcessAgentRequestedChat:function(a){Formilla.isProactive=!0,Formilla.isRequestChat=!0,Formilla.initProactiveFormillaChat(),Formilla.FormillaRenderAgentPic(a),Formilla.FormillaShowMessageToUser(a.RequestChatMessage,!0),Formilla.FormillaAdjustHeight(Formilla.defaultChatMessageCtrHeight),document.cookie="formillaIsChatWindowOpen"+Formilla.guid+"=yes; path=/",document.cookie="formillaRequestChat"+Formilla.guid+"=yes; path=/",Formilla.convertFormillaChatMessageTime()},FormillaUpdateVisitorInfo:function(){var a=Formilla.FormillaGetVisitorCookieValue(),b=!1;if(null!=a&&a.length>0&&(b=!0),null!=a&&a.length>0){var c=("https:"==document.location.protocol?"https://":"http://")+Formilla.formillaDomain+"/ajaxhandler.aspx?rnd="+Math.random();c=c+"&f=updateVisitorInfo&Guid="+Formilla.guid+"&VisitorGuid="+a+"&UserEmail="+Formilla.customerEmail+"&customerName="+encodeURIComponent(Formilla.customerName)+"&customerPhone="+encodeURIComponent(Formilla.customerPhone)+"&screenWidth="+screen.width+"&screenHeight="+screen.height+"&CustomField1="+encodeURIComponent(Formilla.customField1)+"&CustomField2="+encodeURIComponent(Formilla.customField2)+"&CustomField3="+encodeURIComponent(Formilla.customField3)+"&IsReturning="+b+"&IsChatWindowVisible="+Formilla.getFormillaCookie("formillaIsChatWindowOpen"+Formilla.guid)+"&referrer="+encodeURIComponent(document.referrer)+"&pageURL="+encodeURIComponent(Formilla.FormillaGetCurrentPageUrl()),Formilla.dynamicJSONTag(c)}},startFormillaAutoResponderTimer:function(a){var b=0,c=0;if(!Formilla.getFormillaCookie("formillaChatSession"+Formilla.guid))return void(Formilla.autoResponderTimer&&(window.clearInterval(Formilla.autoResponderTimer),Formilla.autoResponderTimer=null));if(Formilla.autoResponderTimer?c=5:Formilla.autoResponderTimer=window.setInterval("Formilla.startFormillaAutoResponderTimer("+a+");",5e3),Formilla.getFormillaCookie("formillaAutoResponderTimer"+Formilla.guid)&&(b=parseInt(Formilla.getFormillaCookie("formillaAutoResponderTimer"+Formilla.guid))+c),document.cookie="formillaAutoResponderTimer"+Formilla.guid+"="+b+"; path=/",5>=a-b){var d=a-b;0>d&&(d=0),window.clearInterval(Formilla.autoResponderTimer),Formilla.autoResponderTimer=null,document.cookie="formillaAutoResponderTimer"+Formilla.guid+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/",setTimeout(function(){Formilla.FormillaTriggerAutoResponder()},1e3*d)}},FormillaTriggerProactiveChatMessage:function(a){Formilla.isProactive=!0,Formilla.initProactiveFormillaChat(),Formilla.FormillaRenderAgentPic(a),Formilla.FormillaShowMessageToUser(Formilla.autoDisplayMessage,!0),Formilla.FormillaAdjustHeight(Formilla.defaultChatMessageCtrHeight),document.cookie="formillaIsChatWindowOpen"+Formilla.guid+"=yes; path=/",Formilla.convertFormillaChatMessageTime()},FormillaTriggerAutoResponder:function(){if(!Formilla.hasAgentResponded){var a=document.getElementById("hdnFormillaSessionId").value;if(a.length>0){var b=("https:"==document.location.protocol?"https://":"http://")+Formilla.formillaDomain+"/ajaxhandler.aspx?rnd="+Math.random();b=b+"&f=triggerAutoResponder&guid="+Formilla.guid+"&hdnFormillaSessionId="+a,Formilla.dynamicJSONTag(b)}}},GetNewFormillaMessages:function(){var a=document.getElementById("hdnFormillaSessionId").value,b=0;document.getElementById("hdnLastChatMessageTimestamp")&&(b=document.getElementById("hdnLastChatMessageTimestamp").value);var c=("https:"==document.location.protocol?"https://":"http://")+Formilla.formillaDomain+"/ajaxhandler.aspx?rnd="+Math.random();c=c+"&f=getFormillaChatMessages&guid="+Formilla.guid+"&hdnFormillaSessionId="+a+"&hdnLastChatMessageTimestamp="+b+"&isUserTyping="+Formilla.isUserTyping+"&callback=FormillaGetMessagesCallback",Formilla.dynamicJSONTag(c)},FormillaGetMessagesCallback:function(a){if(Formilla.FormillaAdjustHeightForMobile(),null!=a){if(a.error){var b=document.createElement("div");b.innerHTML=a.message,Formilla.chatMessagesContainer.appendChild(b.firstChild),Formilla.chatMessagesContainer.scrollTop=Formilla.chatMessagesContainer.scrollHeight}else{if(Formilla.getFormillaCookie("formillaChatSession"+Formilla.guid)&&"none"==document.getElementById("divFormillaChat").style.display&&"yes"!=Formilla.getFormillaCookie("formillaIsMinimized"+Formilla.guid),"True"==a.DeleteChatCookie&&(document.cookie="formillaChatSession"+Formilla.guid+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/",document.getElementById("hdnFormillaSessionId").value="","3"==Formilla.widgetVersion?(Formilla.chatTextbox.value="",Formilla.chatTextbox.disabled=!0):(Formilla.chatTextbox.style.display="none",Formilla.chatEmailTextbox.style.display="inline-block",Formilla.FormillaShowElement(Formilla.chatEmailTextboxContainer),Formilla.FormillaShowElement(Formilla.popupFooterBottom),Formilla.FormillaHideElement(Formilla.popupChatFooter),Formilla.FormillaHideElement(Formilla.agentTypingBar)),""==Formilla.chatEmailTextbox.value.trim()?Formilla.spanChatEmailTextbox.style.display="block":Formilla.spanChatEmailTextbox.style.display="none",Formilla.startChatButton.style.display="block",Formilla.FormillaShowMinimizeButton(!1),Formilla.pollTimer&&(window.clearInterval(Formilla.pollTimer),Formilla.pollTimer=""),Formilla.isIframe||(Formilla.contentHeight=Formilla.contentElement.offsetHeight,Formilla.FormillaRealignWidget(),Formilla.FormillaAdjustHeightForMobile()),"3"==Formilla.widgetVersion&&(Formilla.headerIcon.className="formilla-i-h-message on formilla-drag")),a.HasAgentResponded&&(Formilla.hasAgentResponded=!0,Formilla.FormillaRenderAgentPic(a)),Formilla.chatMessagesContainer.innerHTML.indexOf("divFormillaStartMessage")>0||a.IsUserWaiting||a.ChatSessionStarted)a.IsUserWaiting||a.ChatSessionStarted?Formilla.chatMessagesContainer.innerHTML=Formilla.FormillaLinkify(a.ChatMessages):null!=a.LastChatMessageTimestamp&&"undefined"!=a.LastChatMessageTimestamp&&((null==Formilla.lastChatMessageTimestamp.value||"undefined"==Formilla.lastChatMessageTimestamp.value)&&(Formilla.lastChatMessageTimestamp.value=0),a.LastChatMessageTimestamp>Formilla.lastChatMessageTimestamp.value&&(Formilla.chatMessagesContainer.innerHTML=Formilla.FormillaLinkify(a.ChatMessages),Formilla.FormillaShowChatWidget())),a.ChatSessionStarted&&(Formilla.chatTextbox.disabled=!1,null!=a.autoResponderTimer&&a.autoResponderTimer>0&&(document.cookie="formillaAutoResponderTimer"+Formilla.guid+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/",Formilla.startFormillaAutoResponderTimer(a.autoResponderTimer)),Formilla.FormillaShowChatWidget());else if(null!=a.LastChatMessageTimestamp&&"undefined"!=a.LastChatMessageTimestamp&&((null==Formilla.lastChatMessageTimestamp.value||"undefined"==Formilla.lastChatMessageTimestamp.value)&&(Formilla.lastChatMessageTimestamp.value=0),a.LastChatMessageTimestamp>Formilla.lastChatMessageTimestamp.value)){var b;b="3"==Formilla.widgetVersion?document.createElement("ul"):document.createElement("li"),b.innerHTML=Formilla.FormillaLinkify(a.ChatMessages);for(var c=b.childNodes.length-1;b.childNodes.length>0;c=b.childNodes.length-1)Formilla.chatMessagesContainer.appendChild(b.childNodes[0]);Formilla.FormillaShowChatWidget()}""!=a.ChatMessages&&(a.IsAgentTyping=!1),a.IsAgentTyping?(Formilla.agentIsTypingContainer.style.display="inline","3"!=Formilla.widgetVersion&&(Formilla.agentIsTypingMessage.innerHTML=a.AgentName+" typing...",Formilla.agentIsTypingMessage.style.display="inline"),Formilla.FormillaShowElement(Formilla.agentIsTypingImage)):(Formilla.agentIsTypingMessage.style.display="none",Formilla.FormillaHideElement(Formilla.agentIsTypingImage)),0!=a.LastChatMessageTimestamp&&(Formilla.lastChatMessageTimestamp.value=a.LastChatMessageTimestamp),""!=a.ChatMessages&&(Formilla.chatMessagesContainer.scrollTop=Formilla.chatMessagesContainer.scrollHeight)}Formilla.convertFormillaChatMessageTime()}},FormillaSendMessage:function(a){if(""==a.trim())return!1;Formilla.isProactive?Formilla.proactiveTimer&&window.clearInterval(Formilla.proactiveTimer):Formilla.chatTextbox.disabled=!0;var b=Formilla.FormillaGetVisitorCookieValue(),c=!1;null!=b&&b.length>0&&(c=!0),document.cookie="formillaIsChatWindowOpen"+Formilla.guid+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/",Formilla.FormillaShowMinimizeButton(!0);var d=document.getElementById("hdnFormillaSessionId").value,e=("https:"==document.location.protocol?"https://":"http://")+Formilla.formillaDomain+"/ajaxhandler.aspx?rnd="+Math.random();e=e+"&f=sendChatMessage&guid="+Formilla.guid+"&hdnFormillaSessionId="+d+"&VisitorGuid="+b+"&IsReturning="+c+"&txtFormillaMessage="+encodeURIComponent(Formilla.HTMLEncode(a)),(1==Formilla.startChat||Formilla.isProactive)&&(e=e+"&startChat=1&IsProactive="+Formilla.isProactive+"&IsRequestChat="+Formilla.isRequestChat+"&txtFormillaChatEmailTextbox="+encodeURIComponent(Formilla.chatEmailTextbox.value.trim()),e=e+"&referrer="+encodeURIComponent(document.referrer)+"&pageURL="+encodeURIComponent(Formilla.FormillaGetCurrentPageUrl())+"&customerName="+encodeURIComponent(Formilla.customerName)+"&customerPhone="+encodeURIComponent(Formilla.customerPhone)+"&screenWidth="+screen.width+"&screenHeight="+screen.height+"&CustomField1="+encodeURIComponent(Formilla.customField1)+"&CustomField2="+encodeURIComponent(Formilla.customField2)+"&CustomField3="+encodeURIComponent(Formilla.customField3),Formilla.startChat=0,Formilla.hasAgentResponded=!1,Formilla.chatTextbox.value=a,Formilla.FormillaAdjustHeightForMobile()),e+="&callback=FormillaSendMessageCallback",Formilla.dynamicJSONTag(e)},FormillaSendSilentMessage:function(a,b){var c=("https:"==document.location.protocol?"https://":"http://")+Formilla.formillaDomain+"/ajaxhandler.aspx?rnd="+Math.random();c=c+"&f=sendSilentChatMessage&hdnFormillaSessionId="+a+"&message="+escape(b),Formilla.dynamicJSONTag(c)},FormillaSendMessageCallback:function(a){if(Formilla.chatTextbox.disabled=!1,Formilla.chatTextbox.focus(),null!=a)if(a.error)Formilla.chatMessagesContainer.innerHTML.indexOf("divFormillaStartMessage")>0?Formilla.chatMessagesContainer.innerHTML=Formilla.FormillaFirstMessagePaddingTop()+Formilla.FormillaFormatChatMessage(a.message,!1,!1):Formilla.chatMessagesContainer.appendChild(Formilla.FormillaFormatChatMessage(a.message,!1,!0)),Formilla.chatMessagesContainer.scrollTop=Formilla.chatMessagesContainer.scrollHeight,Formilla.emailUsButton.style.display="",Formilla.chatTextbox.style.height="45px",Formilla.isChatShown=!1,Formilla.isActionPolling=!1,document.onmousemove=null,Formilla.pollForActionTimer&&(window.clearInterval(Formilla.pollForActionTimer),Formilla.pollForActionTimer=""),Formilla.FormillaAdjustHeight("");else{Formilla.getFormillaCookie("formillaChatSession"+Formilla.guid)||Formilla.startFormillaPollTimer(),document.getElementById("hdnFormillaSessionId").value=a.sessionId,document.cookie="formillaChatSession"+Formilla.guid+"="+a.sessionId+"; path=/",Formilla.chatTextbox.style.display="",Formilla.chatEmailTextbox.style.display="none",Formilla.FormillaHideElement(Formilla.chatEmailTextboxContainer),Formilla.FormillaHideElement(Formilla.popupFooterBottom),Formilla.FormillaShowElement(Formilla.popupChatFooter),Formilla.FormillaShowElement(Formilla.agentTypingBar),Formilla.emailUsButton.style.display="none";var b=Formilla.isProactive;if(Formilla.isProactive=!1,null!=a.autoResponderTimer&&a.autoResponderTimer>0&&(document.cookie="formillaAutoResponderTimer"+Formilla.guid+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/",Formilla.startFormillaAutoResponderTimer(a.autoResponderTimer)),a.IsStatusDisplay)Formilla.chatMessagesContainer.innerHTML=a.message+"<br />",Formilla.chatTextbox.disabled=!0;else{var c="";a.IsStartChat?(Formilla.isEmailRequiredToChat||b||(Formilla.chatMessagesContainer.innerHTML=Formilla.FormillaFirstMessagePaddingTop()+Formilla.FormillaFormatChatMessage(a.userStartMessageNoEmail,!0)),c=Formilla.FormillaLinkify(Formilla.HTMLEncode(a.userStartMessage))):c=Formilla.FormillaLinkify(Formilla.HTMLEncode(Formilla.chatTextbox.value)),Formilla.chatMessagesContainer.innerHTML.indexOf("divFormillaStartMessage")>0?Formilla.chatMessagesContainer.innerHTML=Formilla.FormillaFirstMessagePaddingTop()+Formilla.FormillaFormatChatMessage(c,!1,!1):Formilla.chatMessagesContainer.appendChild(Formilla.FormillaFormatChatMessage(c,!1,!0))}Formilla.chatMessagesContainer.scrollTop=Formilla.chatMessagesContainer.scrollHeight,Formilla.chatTextbox.value="",Formilla.FormillaIsUserTyping(),Formilla.chatTextbox.focus(),Formilla.contentHeight=Formilla.contentElement.offsetHeight,a.IsStartChat&&(Formilla.isIframe||(Formilla.FormillaRealignWidget(),Formilla.winheight-Formilla.contentHeight-Formilla.ExtractNumber(Formilla.contentElement.style.top)<150&&(Formilla.contentElement.style.top=Formilla.winheight-Formilla.contentHeight+"px")))}else{var d="There was an error with your message. Please remove any illegal characters and try again.";Formilla.chatMessagesContainer.innerHTML.indexOf("divFormillaStartMessage")>0?Formilla.chatMessagesContainer.innerHTML=Formilla.FormillaFirstMessagePaddingTop()+Formilla.FormillaFormatChatMessage(d,!1,!1):Formilla.chatMessagesContainer.appendChild(Formilla.FormillaFormatChatMessage(d,!1,!0)),Formilla.chatMessagesContainer.scrollTop=Formilla.chatMessagesContainer.scrollHeight,Formilla.emailUsButton.style.display="",Formilla.chatTextbox.style.height="45px"}},ExtractNumber:function(a){var b=parseInt(a);return null==b||isNaN(b)?0:b},FormillaIsValidEmail:function(a){if(""==a||null==a)return!1;var b=/^[A-Za-z0-9']([\.\-\+]?[a-zA-Z0-9'_])*\@([A-Za-z0-9\-]+\.)+[A-Za-z]{2,15}$/;return b.test(a.trim())?!0:!1},FormillaFirstMessagePaddingTop:function(){return""},FormillaFormatChatMessage:function(a,b,c){var d="",e="",f="",g="",h="",i="";if(d="color:"+Formilla.chatPopupTextColor+";",userNameSeparatorColor="background-color:"+Formilla.chatPopupTextColor+";",Formilla.isChatMessageStyleInline&&(e="color:"+Formilla.userChatMessageTextColor+";",f="background-color:"+Formilla.userChatMessageBackgroundColor+";",g="fill:"+Formilla.userChatMessageBackgroundColor+";"),"3"==Formilla.widgetVersion)if(b){if(h="<li style='text-align: center !important;'><div style='display: inline-block !important;'>"+a+"</div></li>",c){var j=document.createElement("ul");j.innerHTML=h,h=j.firstChild}}else{i="<span>",i+="<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 48 35' style='enable-background:new 0 0 48 35;' xml:space='preserve'>",i+="<path style='fill-rule:evenodd;clip-rule:evenodd;"+g+"'d='M167.5,0c0,11.666,0,23.334,0,35c-51.995,0-104.005,0-156,0c0.723-4.181,2.11-15.655-4.471-26.647C4.884,4.769,2.388,2.065,0.167,0.083C55.944,0.056,111.722,0.028,167.5,0z'></path>",i+="<path style='fill-rule:evenodd;clip-rule:evenodd;"+g+"' d='M2.583,15.917'></path>",i+="</svg>",i+="</span>";var k=Formilla.getFormillaTimeFromUtcDate(Formilla.convertDateToUTC(new Date));if(h="<li class='left_msg'>",h+="<span class='formilladg_title formillaUserMessageCtr' style='"+d+"' >",h+="<span class='formilladg_title_h formillaUserNameCtr' style='"+d+"'>"+Formilla.userChatMessageLabel+"</span>",h+="<span class='formilladg_circle' style='"+userNameSeparatorColor+"'></span>",h+=k,h+="</span>",h+="<span class='fdgc_msg_2' style='"+f+"'>",h+=i,h+="<article style='"+e+"'>",h+=a,h+="</article>",h+="</span>",h+="</li>",c){var j=document.createElement("ul");j.innerHTML=h,h=j.firstChild}}else if(h='<div class="formillaUserMessageCtr" style="'+e+"float:left; clear:both; display: inline; border-radius: 4px; margin-bottom: 7px; padding: 5px;"+f+'">',b||(h+='<span class="formillaUserNameCtr" style="'+e+'font-weight: bold;">'+Formilla.userChatMessageLabel+": </span>"),h+=a+"</div>",c){var j=document.createElement("div");j.innerHTML=h,h=j.firstChild}return h},convertDateToUTC:function(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds())},HTMLEncode:function(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;")},showAttnGrabberCloseBtn:function(a){a?document.getElementById("formilla-attn-close").style.display="block":document.getElementById("formilla-attn-close").style.display="none"},hideAttnGrabber:function(){document.getElementById("formilla-attn-grabber-ctr").style.display="none";var a=new Date;a.setTime(a.getTime()+864e5);var b="; expires="+a.toGMTString();document.cookie="AttnGrabberClosed"+Formilla.guid+"=yes"+b+"; path=/"},showOfflineAttnGrabberCloseBtn:function(a){a?document.getElementById("formilla-off-attn-close").style.display="block":document.getElementById("formilla-off-attn-close").style.display="none"},hideOfflineAttnGrabber:function(){document.getElementById("formilla-off-attn-grabber-ctr").style.display="none";var a=new Date;a.setTime(a.getTime()+864e5);var b="; expires="+a.toGMTString();document.cookie="OfflineAttnGrabberClosed"+Formilla.guid+"=yes"+b+"; path=/"},FormillaGetStyle:function(a,b){return a.currentStyle?a.currentStyle[b]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(a,"")[b]:a.style[b]},FormillaLinkify:function(a){var b,c,d,e;return c=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,b=a.replace(c,'<a href="$1" style="text-decoration: underline;color: inherit !important;" target="_blank">$1</a>'),d=/(^|[^\/])(www\.[\S]+(\b|$))/gim,b=b.replace(d,'$1<a href="http://$2" style="text-decoration: underline;color: inherit !important;" target="_blank">$2</a>'),e=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,15})+)/gim,b=b.replace(e,'<a href="mailto:$1" style="text-decoration: underline;color: inherit !important;">$1</a>')},initFormillaMobile:function(){Formilla.isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return Formilla.isMobile.Android()||Formilla.isMobile.BlackBerry()||Formilla.isMobile.iOS()||Formilla.isMobile.Opera()||Formilla.isMobile.Windows()}}},FormillaIsSearchBot:function(){return/bot|googlebot|mediapartners-google|yahooseeker|yahoo! slurp|crawler|spider|robot|crawling/i.test(navigator.userAgent)},FormillaGetCurrentPageUrl:function(){return""!=Formilla.wixPageUrl?Formilla.wixPageUrl:window.location!=window.parent.location?document.referrer:document.location},FormillaGetVisitorCookieValue:function(){var a=null;return Formilla.isIframe?0!=Formilla.csid&&(a=Formilla.getFormillaCookie("formillaVisitorGuid"+Formilla.csid)):a=Formilla.getFormillaCookie("formillaVisitorGuid"),a},FormillaWriteVisitorCookieValue:function(a){if(null!=a&&a.length>0){var b=new Date;b.setTime(b.getTime()+31536e7);var c="expires="+b.toUTCString()+";";Formilla.isIframe?0!=Formilla.csid&&(document.cookie="formillaVisitorGuid"+Formilla.csid+"="+a+"; "+c+" path=/"):document.cookie="formillaVisitorGuid="+a+"; "+c+" path=/"}},FormillaShowMessageToUser:function(a,b){if(Formilla.chatMessagesContainer.innerHTML.indexOf("divFormillaStartMessage")>0||b)Formilla.chatMessagesContainer.innerHTML=Formilla.FormillaFirstMessagePaddingTop()+a;else{var c;c="3"==Formilla.widgetVersion?document.createElement("li"):document.createElement("div"),c.innerHTML=a,Formilla.chatMessagesContainer.appendChild(c.firstChild)}},FormillaAdjustHeight:function(a){""==a?Formilla.contentHeight!=Formilla.contentElement.offsetHeight&&(document.getElementById("divFormillaResponseBox").style.height=parseInt(document.getElementById("divFormillaResponseBox").offsetHeight)+(Formilla.contentHeight-Formilla.contentElement.offsetHeight)+"px",Formilla.isIframe?Formilla.contentElement.style.top="auto":Formilla.contentElement.style.top==Formilla.winheight-Formilla.contentHeight+"px"&&(Formilla.contentElement.style.top=Formilla.winheight-Formilla.contentElement.offsetHeight+"px"),Formilla.contentHeight=Formilla.contentElement.offsetHeight):""!=Formilla.chatMessagesContainer&&Formilla.chatMessagesContainer.style.height!=a&&(Formilla.chatMessagesContainer.style.height=a,Formilla.contentHeight=Formilla.contentElement.offsetHeight,Formilla.isIframe?Formilla.contentElement.style.top="auto":(Formilla.FormillaRealignWidget(),Formilla.winheight-Formilla.contentHeight-Formilla.ExtractNumber(Formilla.contentElement.style.top)<150&&(Formilla.contentElement.style.top=Formilla.winheight-Formilla.contentHeight+"px"),Formilla.contentHeight=Formilla.contentElement.offsetHeight)),Formilla.initFormillaDragDrop(!0)},FormillaRealignWidget:function(){Formilla.isIframe||Formilla.ExtractNumber(Formilla.contentElement.style.top)>=Formilla.winheight-Formilla.contentHeight&&(Formilla.contentElement.style.top=Formilla.winheight-Formilla.contentHeight+"px")},FormillaResizeIframeContainer:function(a,b){"undefined"!=typeof Wix&&Wix.resizeWindow(a,b)},FormillaCheckCookiesEnabled:function(){return document.cookie="testFormillacookie=1; path=/",cookieEnabled=-1!=document.cookie.indexOf("testFormillacookie")?!0:!1,cookieEnabled&&(document.cookie="testFormillacookie=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"),cookieEnabled},FormillaMinimizeChatWindow:function(a){document.getElementById(a).style.display="none",Formilla.FormillaRemoveMobileOverlayStyles(),document.cookie="formillaIsMinimized"+Formilla.guid+"=yes; path=/"},FormillaShowMinimizeButton:function(a){minimizeButton=document.getElementById("formilla-chat-minimize-link"),null!=minimizeButton&&(a?minimizeButton.style.display="block":minimizeButton.style.display="none")},FormillaRemoveMobileOverlayStyles:function(){var a=document.getElementsByTagName("head").item(0),b=document.getElementById("formilla-mobile-overlay");null!=b&&a.removeChild(b)},FormillaShowChatWidget:function(){Formilla.initFormillaChat(),Formilla.FormillaRealignWidget()},FormillaAdjustHeightForMobile:function(){Formilla.hasMobileCSS&&screen.width<=Formilla.maxResolutionForMobile&&setTimeout(function(){Formilla.FormillaAdjustHeight(Formilla.contentElement.scrollHeight-Formilla.mobileCSSSubtractFromHeight+"px")},500)},FormillaShowElement:function(a){null!=a&&(a.style.display="block")},FormillaHideElement:function(a){null!=a&&(a.style.display="none")},FormillaRenderAgentPic:function(a){if("3"==Formilla.widgetVersion)if(a.AgentPic){Formilla.headerIcon.style.display="none";var b=("https:"==document.location.protocol?"https://":"http://")+Formilla.formillaDomain+"/ImageGen.ashx?image="+a.AgentPic+"&height=50";Formilla.headerAgentPicture.src=b,Formilla.headerAgentPicture.style.display="inline-block"}else Formilla.headerIcon.className="formilla-i-h-user formilla-drag"}};